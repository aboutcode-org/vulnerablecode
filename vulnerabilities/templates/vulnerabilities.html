{% extends 'base.html' %}
{% block title %}
<h1 class="title">
Explore Vulnerabilities
</h1>
{% endblock %}
{% block content %}

<div class="columns">
    <div class="column is-one-third is-offset-one-third">
     <form action="{% url 'vulnerability_search' %}" method="get">
      {% load widget_tweaks %}
      <div class="field is-horizontal">
        {% with searched_for as query%}
          {% render_field form.vuln_id class="input" value=query %}
        {% endwith %}
        <button class="button is-success", type="submit">
          Search
        </button>
      </div>
      </form>
      {% if searched_for %}
      <p class="has-text-centered">{{result_size}} results</p>
      {% endif %}
       </div>
</div>

{% if vulnerabilities %}
    <section class="section">
      
        <div class="content is-large">
          <table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth">
          <tr>
              <th>Vulnerability ID</th>
              <th>Vulnerable packages</th>
              <th>Patched packages</th>
          </tr>
          {% for vulnerability in  vulnerabilities %}
              <tr>
                  <td><a href="{% url 'vulnerability_view' vulnerability.pk %}">{{vulnerability.cve_id}}</a></td>
                  <td>{{vulnerability.vulnerable_to.all|length}}</td>
                  <td>{{vulnerability.resolved_to.all|length}}</td>
              </tr>
          {% endfor %}
          </table>
        </div>

        <div class="is-field is-horizontal">
          {% if vulnerabilities.has_previous %}
            <a class="button" href="?vuln_id={{ searched_for }}&page={{ vulnerabilities.previous_page_number }}">Previous Page</a>
          {% endif %}

          {% if vulnerabilities.has_next %}
            <a class="button" href="?vuln_id={{ searched_for }}&page={{ vulnerabilities.next_page_number}}">Next Page</a>
          {% endif %}
        </div>

    </section>

{% elif result_size == 0 %}
    <section class="section is-medium has-text-centered">
      <div class="container">
        <h1 class="title" id="results">No result found for "{{searched_for}}"</h1>
      </div>
    </section>

{% endif %}

{% endblock %}
